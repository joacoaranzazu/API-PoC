version: '3.8'

services:
  # API Gateway
  api-gateway:
    build:
      context: ./api
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
      - JWT_SECRET_KEY=eagowl-poc-secret-key-2024
      - WALKIEFLEET_URL=http://poc1.eagowl.co:9998
      - WALKIEFLEET_USER=10000
      - WALKIEFLEET_PASS=1948
      - AI_ANALYTICS_URL=http://ai-analytics:5001
      - SMART_MAP_URL=http://smart-map:5002
      - FLEET_OPTIMIZER_URL=http://fleet-optimizer:5003
      - PREDICTIVE_ALERTS_URL=http://predictive-alerts:5004
      - DEBUG=false
    depends_on:
      - ai-analytics
      - smart-map
      - fleet-optimizer
      - predictive-alerts
    networks:
      - eagowl-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # AI Analytics Service
  ai-analytics:
    build:
      context: ./services/ai-analytics
      dockerfile: Dockerfile
    ports:
      - "5001:5001"
    environment:
      - PORT=5001
      - DEBUG=false
    networks:
      - eagowl-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Smart Map Service
  smart-map:
    build:
      context: ./services/smart-map
      dockerfile: Dockerfile
    ports:
      - "5002:5002"
    environment:
      - PORT=5002
      - DEBUG=false
    networks:
      - eagowl-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5002/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Fleet Optimizer Service
  fleet-optimizer:
    build:
      context: ./services/fleet-optimizer
      dockerfile: Dockerfile
    ports:
      - "5003:5003"
    environment:
      - PORT=5003
      - DEBUG=false
    networks:
      - eagowl-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5003/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Predictive Alerts Service
  predictive-alerts:
    build:
      context: ./services/predictive-alerts
      dockerfile: Dockerfile
    ports:
      - "5004:5004"
    environment:
      - PORT=5004
      - DEBUG=false
    networks:
      - eagowl-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5004/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Web UI
  web-ui:
    build:
      context: ./web-ui
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:5000
      - NEXT_PUBLIC_MAP_API_KEY=your-map-api-key-here
    depends_on:
      - api-gateway
    networks:
      - eagowl-network
    restart: unless-stopped

networks:
  eagowl-network:
    driver: bridge

volumes:
  analytics-data:
  map-data:
  optimizer-data:
  alerts-data: